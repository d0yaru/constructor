/*! script(1).js */
function updateConstrPrices(){orderSum()}function number_format(number,decimals,dec_point,thousands_sep){var i,j,kw,kd,km;return isNaN(decimals=Math.abs(decimals))&&(decimals=2),null==dec_point&&(dec_point=","),null==thousands_sep&&(thousands_sep="."),(j=(i=parseInt(number=(+number||0).toFixed(decimals))+"").length)>3?j%=3:j=0,(km=j?i.substr(0,j)+thousands_sep:"")+(kw=i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+thousands_sep))+(kd=decimals?dec_point+Math.abs(number-i).toFixed(decimals).replace(/-/,0).slice(2):"")}$((function(){function updateFiles(file){var filename=file.val().split("\\"),form=file.parents("form");filename=filename[filename.length-1],$(".fileUpWrap",form).before('<p class="file-display"><i class="downloadIco noname"></i> '+filename+' <span class="fileDel" data-del="'+filename+'"></span></p>'),file.removeAttr("id").attr("name","files[]").detach().appendTo(".file-display:last",form),$(".js-file",form).append('<input class="inpFile file-to-upload" type="file">'),$(".file-to-upload",form).on("change",(function(){updateFiles($(this))})),$(".file-display",form).find(".fileDel").on("click",(function(e){e.preventDefault(),$(this).parent().remove()}))}function recalculatePrice(form){var articleKey=form.attr("data-id");if("undefined"!=typeof TYPE_REF&&articleKey in TYPE_REF){var currentType=$('select[name="TYPE"]',form).val();currentType in TYPE_REF[articleKey]&&$('select, input[type="hidden"]',form).not('[name="TYPE"]').each((function(){$(this).attr("name")in TYPE_REF[articleKey][currentType]?$(this).parent().parent().show():$(this).parent().parent().hide()}))}if($('select, input[type="hidden"]',form).not(".js-not-key").each((function(){"none"!=$(this).parent().css("display")&&"none"!=$(this).parent().parent().css("display")&&(articleKey+=$(this).val())})),articleKey in ARTICLES_FORM&&"undefined"!=typeof ARTICLES_FORM){var count=parseInt($(".basket-count",form).val()),price=parseInt(ARTICLES_FORM[articleKey].PRICE)*count;0==price&&(price="По запросу"),isNaN(price)||"number"!=typeof price?($(".js-article-title",form).html("&nbsp;"),$(".basket-price",form).val(price).attr("data-val",price)):($(".js-article-title",form).html(ARTICLES_FORM[articleKey].ARTICLE),$(".basket-price",form).val(number_format(price,0,"."," ")).attr("data-val",price))}else $(".js-article-title",form).html("&nbsp;"),$(".basket-price",form).val("По запросу").attr("data-val","По запросу")}function inArray(needle,haystack){for(var length=haystack.length,i=0;i<length;i++)if(haystack[i]==needle)return!0;return!1}function showMsg(div,msg){div.parent().append('<div class="hint">'+msg+' <i class="arr"></i></div>'),setTimeout("$('.hint').remove()",2e3)}function showDealersInCity(){$(".partnerWrap .js-dealers").hide(),$('[data-city-id="'+$("#city").val()+'"]').show(),showDealer(),$("#map").trigger("setMarker")}$(".file-to-upload").on("change",(function(){updateFiles($(this))})),$(".js-form-articles").each((function(){var $form=$(this);$(".js-type-articles",$form).on("change",(function(){$("select",$form).not($(this)).parent().hide(),$('select[data-type="'+$(this).val()+'"]',$form).not($(this)).parent().show()})),$("select",$form).on("change",(function(){recalculatePrice($form);var parent=$(this).parents("form");parent.find(".addToBasket").show(),parent.find(".js-go-to-basket").hide()})),$(".basket-count",$form).on("change, keyup",(function(){recalculatePrice($form)})),recalculatePrice($form)})),$(".addToBasket").on("click",(function(e){e.preventDefault();var showPopup_popup_id="antistat-nozh",showPopup_items=[4681,4690,20279,20284,20281,4693,23713,4698,4701,4696,4703,5332,4684],$prod_id;inArray($(this).parents(".js-form-articles").attr("data-id"),showPopup_items)&&$.magnificPopup.open({items:{src:'<div class="white-popup">К антистатическому стулу требуется заказать <a target="_blank" href="/production/esd_chairs/antistaticheskie_nozhki_vkg_f_05/">антистатические ножки</a> или <a target="_blank" href="/production/esd_chairs/antistaticheskie_kolesa/">антистатические колеса</a></div>',type:"inline"},closeBtnInside:!0});var $form=$(this).parents("form"),articleKey=$form.attr("data-id"),button=$(this);if($('select, input[type="hidden"]',$form).not(".js-not-key").each((function(){"none"!=$(this).parent().css("display")&&(articleKey+=$(this).val())})),console.log(articleKey),articleKey in ARTICLES_FORM&&"undefined"!=typeof ARTICLES_FORM){var count=parseInt($(".basket-count",$form).val()),id=parseInt(ARTICLES_FORM[articleKey].ID),$add_params=[];$form.find(".js-not-key").each((function(){$label=$(this).parents(".frmBox").find(".inpLbl").text(),$value=$(this).val(),$add_params.push($label+": "+$value)})),console.log($add_params),!isNaN(id)&&count>0?$.ajax({url:$form.attr("action"),method:"post",data:{ID:id,COUNT:count,ADD_PARAMS:$add_params},type:"POST",dataType:"json"}).done((function(r){button.hide(),button.siblings(".js-go-to-basket").show(),showMsg(button,r.text),$(".service").hasClass("withBasket")||$(".service").addClass("withBasket"),$(".js-cart-total").length?$(".js-cart-total").html(r.basketText):$(".service").prepend('<a href="/order/" class="lieButton js-cart-total">'+r.basketText+"</a>")})):showMsg(button,JS_LANG.CANT_ADD_TO_BASKET)}else showMsg(button,JS_LANG.CANT_ADD_TO_BASKET)})),$("#city").on("change",(function(){showDealersInCity(),$("#map").trigger("setCenter")})),$("#orderSend").length&&showDealersInCity(),$(".js-dealer").on("change",(function(){showDealer(),$("#map").trigger("setMarker")})),$("#orderSend").on("submit",(function(e){e.preventDefault();var $form=$(this),url=$(this).attr("action"),data=$form.serialize(),error=!1;return $form.hasClass("is-loading")||($form.find(".require-inp").each((function(){var $input=$(this);!$input.length||$.trim($input[0].value).length&&""!=$input[0].value||($input.addClass("error"),error=!0)})),error||($form.addClass("is-loading"),$.ajax({url:url,data:new FormData($form.get(0)),type:"POST",processData:!1,contentType:!1,dataType:"json"}).done((function(r){1==r.status?($(".orderSend").html("<p>"+r.text+"</p>"),"undefined"!=typeof ym&&ym(44925766,"reachGoal","formadistriba"),"undefined"!=typeof gtag&&gtag("event","formadistriba",{event_category:"one"}),console.log("reachGoal - form formadistriba")):$(".orderSend .col:first").append("<p>"+r.text+"</p>"),$form.removeClass("is-loading")})))),!1})),$(".js-save-to-computer").on("click",(function(e){return e.preventDefault(),"undefined"!=typeof ID&&"undefined"!=typeof COMPL&&(window.location.href="?"+$.param({save:1,id:ID,compl:COMPL})),!1})),updateConstrPrices(),$("#constructor-type.js-not-chosen").chosen({disable_search_threshold:10,width:"100%",search_contains:!0}).change((function(e){window.location.href=$(e.target).val()})),$(".tooltip-content span").on("click",(function(){var $this=$(this);$this.hasClass("tooltip-active")||$this.addClass("tooltip-active"),$this.find("input").prop("checked",!0),$this.siblings("span").removeClass("tooltip-active").find("input").prop("checked",!1),"function"==typeof updateConstructor&&updateConstructor()})),$(".js-auto-props").on("click",(function(e){e.preventDefault();var $this=$(this),$selector="";$(".tooltips-opened").removeClass("tooltips-opened"),$this.siblings(".tooltip-content").length>0&&$this.parent().addClass("tooltips-opened")}))}));